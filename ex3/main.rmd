
--- 
title: 'TMA4300 Computer Intensive Statistical Methods Exercise 2, Spring 2021'
output:
  html_document:
    toc: yes
    toc_depth: 2
    toc_float: yes
  pdf_document:
    toc: no
    toc_depth: '2'
date: "`r format(Sys.time(), '%d.%m.%Y')`"
subtitle: 'Group members: Eide, Jonathan and Lima-Eriksen, Leik'
---

\usepackage{amsmath}

\newcommand{\indep}{\perp \!\!\! \perp}
\newcommand{\vect}[1]{\boldsymbol{\mathbf{#1} }}
\newcommand{\matr}[1]{\boldsymbol{\mathbf{#1} }}
\newcommand{\Var}{\textrm{Var}}
\newcommand{\E}{\textrm{E}}
\newcommand{\Cov}{\textrm{Cov}}
\newcommand{\Corr}{\textrm{Corr}}

# Problem A: Comparing AR(2) parameter estimators using resampling of residuals


# Problem B: Permutation test

## 1:
Bilirubin (see http://en.wikipedia.org/wiki/Bilirubin) is a breakdown product of haemoglobin,
which is a principal component of red blood cells. If the liver has suffered degeneration, if the decomposition of haemoglobin is elevated, or if the gall bladder has been destroyed, large amounts of bilirubin can
accumulate in the blood, leading to jaundice. The following data (taken from JÃ¸rgensen (1993)) contain
measurements of the concentration of bilirubin (mg/dL) in blood samples taken from three young men.

We use a boxplot to inspect the data from three different individuals:
```{R}
#Load data
bilirubin <- read.table("bilirubin.txt",header=T)

#Boxplot of data
boxplot(log(meas)~pers,
        data=bilirubin,
        main="Boxplot of Concentration (Logarithmic scale)",
        xlab="Individual",
        ylab="log(meas)"
        )

```

It seems like the levels are higher for p3, and we want to investigate whether the difference is significant.

We fit the linear regression model using $ \textbf{lm} $:

\begin{equation} \label{eq:model_B1}
\ln(Y_{i,j}) = \beta_i + \epsilon_{i,j}, \qquad \textrm{with } i = 1,2,3 \textrm{ and } j = 1, \dots, n_i
\end{equation}

where $n_1=11, n_2=10$ and $n_3=8$, and $\epsilon \sim N(0, \sigma^2).$ 

```{R}
model.reg = lm(log(meas)~pers, data=bilirubin)
summary.lm = summary(model.reg)

summary.lm

```
We want to test the hypotesis that all the individuals bilrubin levels are the same for all individuals: $\beta_1=\beta_2=\beta_3,$. This is tested using the F-test from statistic in summary. The p-value is 0.03946, which means that we can reject the hypothesis that all individuals have the same bilirubin-levels at a sigificance level of 5%.


```{R}
Fval = summary.lm$fstatistic

Fval

```

## 2:

We want to write a function $\textbf{permTest()}$ which generates a permutation of the data between the three individuals, consequently fits the model given in (1) and finally returns the value of the F-statistic for
testing $\beta_1=\beta_2=\beta_3,$.


```{R}
permTest = function(bilirubin) {
  df = data.frame(meas=sample(bilirubin$meas), pers = bilirubin$pers)
  model.reg = lm(log(meas)~pers, data=df)
  Fval = summary(model.reg)$fstatistic["value"]
  return(Fval)
}

#Test the function
permTest(bilirubin)


```

##3:

Next we perform a permutation test between the three individuals using the function $\textbf{permTest()}$ to check whether there is an actual difference in the bilirubin level in the individuals. This is done generating 999 samples of the F-statistic, and comparing this to the original F-statistic, Fval.If the F-statistic is as high or higher than the original F-statistic, there is no difference in the bilirubin levels of the persons.

```{R}
#Create samples
samples = rep(0,999)
for(i in 1:999){
  samples[i] = permTest(bilirubin)
}

# Compute p-value for Fval using samples:
p.val = length(samples[samples>=Fval["value"]])/999

p.val

```
The result is a p-value of 0.036, which means that at a significance level of 5% we reject the hypothesis that the bilirubin levels are the same for all persons.

# Problem C: The EM-algorithm and bootstrapping

